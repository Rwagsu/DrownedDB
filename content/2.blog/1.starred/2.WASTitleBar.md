---
title: Windows App SDK 1.4 的标题栏可拖拽问题
description: 不一定是最新, 因为我已经换 Uno Platform 了()
icon: material-symbols:folder-outline-rounded

badges:
  - value: 2024-03-12
    icon: ri:window-2-line
    target: _blank

authors:
  - name: Rwagsu
    username: Rwagsu
    avatar: https://www.github.com/Rwagsu.png
    to: https://github.com/Rwagsu
    target: _blank
---

自从 Windows App SDK 1.4 发布起，搜索结果的几个排在前面的文章中的更改标题栏可拖拽区域已经全部失效了, 因为 `SetDragRectangles` 方法在Microsoft Learn中已经标记为 "已废弃", 这意味这这个方法已经不能在新版 Windows App SDK 1.4 起作用 (从没见过更新如此明显的库(雾))

当然, Microsoft给了一个替代方法, 这个方法是我在 [Microsoft Q&A](https://learn.microsoft.com/en-us/answers/questions/1362230/how-to-fix-appwindow-titlebar-setdragrectangles-no) 问到的 :)

代码如下:

```csharp {5}
IntPtr hWndMain = WinRT.Interop.WindowNative.GetWindowHandle(this);
Microsoft.UI.WindowId myWndId = Microsoft.UI.Win32Interop.GetWindowIdFromWindow(hWndMain);

var incps = InputNonClientPointerSource.GetForWindowId(myWndId);
incps.SetRegionRects(NonClientRegionKind.Caption, new RectInt32[] { new RectInt32(X, Y, Width, Height) });
```
::alert{type="info" icon="lucide:info"}
如果你在写了代码后报错, 那么大概率是你没引用, 引用就行了, 或者是你的 Windows App SDK 版本太低或者太高 (不会微软只用一会就给废弃了吧？（*゜ー゜*）)
::

其中, X, Y 表示横坐标和纵坐标, Width 表示宽, Height 表示高.

不建议删除代码的任何内容 (除非你代码已经写了这些东西的其中一些), 因为这段代码的所有地方都是关联起来的, 你在修改后可能会导致报错, 异常或各种Bug (当然如果你有更好的解决方案当我没说).

当然, 变量名随便改😉

::alert{type="warning" icon="lucide:triangle-alert"}
通过这种方式更改的标题栏可拖拽区域仍然会受到你的屏幕缩放设置的影响, 目前仅能保证100%的屏幕缩放不出现问题, 太高或太低的屏幕缩放会使区域变大或变小, 示例方法没有考虑到这个设置的影响 (我也不会啊 QAQ 找了那么多文章问了那么多 AI 一个不能用) 所以你可能要自己编写兼容方法. (对了, 如果成功了, 在评论告诉一声哈awa)
::